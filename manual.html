<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Orasash by pioro</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">OraSASH</h1>
        <p class="header">Oracle Simulation ASH</p>

        <ul>
		  <li class="download"><a class="buttons_noarrow" href="index.html">OraSASH</a></li>
          <li class="download"><a class="buttons_noarrow" href="installation.html">Instalation</a></li>
		  <li class="download"><a class="buttons_noarrow" href="manual.html">User manual</a></li>
		  <li class="download"><a class="buttons_noarrow" href="history.html">Project history</a></li>
          <li class="download"><a class="buttons" href="https://github.com/pioro/orasash/archive/v2.3.zip">Download ZIP</a></li>
          <li><a class="buttons github" href="https://github.com/pioro/orasash">View On GitHub</a></li>
        </ul>

        <p><small>This project is maintained by <a href="https://github.com/pioro">Marcin Przepiorowski</a></small></p>
		<p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> based on the Dinky theme</small></p>

      </header>
      <section>
	  <h2>Daily operations</h2>
	  <h3>Starting / stopping collection jobs</h3>
To start job connect as repository owner and run script <pre>SQL> @start.sql</pre> or pl/sql function <pre>SQL> exec sash_repo.start_collecting_jobs;</pre> 
To stop run script <pre>SQL> @stop</pre> or pl/sql funcktion <pre>exec sash_repo.stop_collecting_jobs;</pre>  


<h3>Checking jobs status</h3>
Login as user sash to repository database and run following script - 
<pre>SQL> @job_stat.sql</pre>
Output should be similar to this
<pre>SQL> @job_stat.sql

JOB_NAME LAST_START_DATE NEXT_RUN_DATE STATE FAILURE_COUNT
------------------------------ ----------------------------------- ----------------------------------- --------------- -------------
SASH_PKG_GET_ALL_POLTP1 24-NOV-11 03.00.30.431000 +00:00 24-NOV-11 03.15.30.300000 +00:00 SCHEDULED 0
SASH_REPO_PURGE 25-NOV-11 00.00.00.000000 +00:00 SCHEDULED 0
SASH_REPO_WATCHDOG 24-NOV-11 11.00.30.408000 +00:00 24-NOV-11 11.05.30.000000 +00:00 SCHEDULED 0
SASH_PKG_COLLECT_POLTP1 24-NOV-11 11.00.30.295000 +00:00 24-NOV-11 11.00.30.000000 +00:00 RUNNING 0
</pre>

<h3>Checking log table</h3>
Check repository error log using the following script
<pre>SQL> @checklog.sql</pre>
Example output
<pre>SQL> @checklog.sql

R START_TIME ACTION MESSAGE
- ------------------------- ------------------------------------------------ ------------------------------------------------------------------------
W 2011-11-24 11:07:20 add_db no db link - moving forward POLTP1
I 2011-11-24 11:07:20 configure_db get_event_names
I 2011-11-24 11:07:20 configure_db get_users
I 2011-11-24 11:07:20 configure_db get_params
I 2011-11-24 11:07:20 configure_db get_data_files
I 2011-11-24 11:07:20 configure_db get_metrics
I 2011-11-24 11:07:20 add_instance_job adding scheduler job sash_pkg_collect_POLTP1
I 2011-11-24 11:07:20 add_instance_job adding scheduler job sash_pkg_get_all_POLTP1
I 2011-11-24 11:07:21 create_repository_jobs adding new repository job

9 rows selected.
</pre>
<h3>Data retention change</h3>
To change default month retention you can use following pl/sql function 
<pre>exec sash_repo.set_retention('<retention>');</pre>
where &lt;retention&gt; is one of:
- d - last week
- w - last month
- h - last 24 h
- m - last 30 minutes

	  <h3>Adding new database</h3>
New databases can be added by using adddb.sql script when connected to repository using respository owner.
The following questions have to be answered:
<ul>
<li>database name,</li> 
<li>number of instances (1 for single instance database or more than one for RAC database),</li>
<li>target database host name</li>
<li>instance(s) name</li>
<li>listener port</li>
<li>password for sash user on target database.</li>
</ul>
<pre>SQL> @adddb
Enter database name newdb
Enter number of instances [default 1]
Enter host name for instance number 1 newdb.localdomain
Enter instance name for instance number 1 [ default newdb ]
Enter listener port number [default 1521]
Enter SASH password on target database sash
"------------------------------------------------------------------------------------"
Database added.
"------------------------------------------------------------------------------------"
</pre>
<h3>Managing multi-database repository</h3>
If you added more than one database to the repository there is concept of current database. 
All SASH views limit data to the database defined as current and allow DBA to query views like in single database repository.

To display a current database the following script can be used:

<pre>
SQL> @currentdb.sql

List of configured databases

DBNAME                               DBID HOST                             INST_NUM CURRENT_DB
------------------------------ ---------- ------------------------------ ---------- ----------
test122                        3501342205 192.168.1.46                            1 *
testse                         4169104998 oraclese                                1
</pre>

To switch a current database to other one the following script can be used:

<pre>
SQL> @switchdb.sql

DBNAME                               DBID HOST                             INST_NUM CURRENT_DB
------------------------------ ---------- ------------------------------ ---------- ----------
test122                        3501342205 192.168.1.46                            1 *
testse                         4169104998 oraclese                                1

Switch to database with DBID 4169104998

Switch to instance with INST_NUM 1

Database switched.

DBNAME                               DBID HOST                             INST_NUM CURRENT_DB
------------------------------ ---------- ------------------------------ ---------- ----------
test122                        3501342205 192.168.1.46                            1
testse                         4169104998 oraclese                                1 *
SQL> @currentdb.sql

List of configured databases

DBNAME                               DBID HOST                             INST_NUM CURRENT_DB
------------------------------ ---------- ------------------------------ ---------- ----------
test122                        3501342205 192.168.1.46                            1
testse                         4169104998 oraclese                                1 *
</pre>

<h3>Manuall configuration</h3>
If for any reason adddb.sql can't be used steps specified below allow expirienced user to manually configure new database
To add database(s) instance(s) to repository using following package can be used:
<pre>exec sash_repo.add_db('svr1-vip', <listener_port>, <target password for sash user>, '<dbname>', '<instance_name>', <instance_number>, '<db_version>', <number of cores>);
select db_link from sash.sash_targets;
exec sash_pkg.configure_db('<db_link>');
exec sash_pkg.set_dbid('<db_link>');
</pre>
ex. one instance
<pre>exec sash_repo.add_db('svr1', 1521, 'sash', 'test', 'test1', 1, '11.2.0.2', 8);
exec sash_pkg.configure_db('test1');
exec sash_pkg.set_dbid('test1');
</pre>
ex. RAC
<pre>exec sash_repo.add_db('svr1-vip', 1521, 'sash', 'test', 'test1', 1, '11.2.0.2', 8);
exec sash_repo.add_db('svr2-vip', 1521, 'sash', 'test', 'test2', 2, '11.2.0.2', 8);
exec sash_pkg.configure_db('test1');
exec sash_pkg.set_dbid('test1');
</pre>
To setup a new jobs following package can be used:
<pre>SQL> exec sash_repo.setup_jobs
</pre>
	  </section>
      <footer>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>		
